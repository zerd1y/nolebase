# é»‘é©¬ç‚¹è¯„

>[!INFO] æ¨¡å—ä»‹ç»
>ä¸»è¦åŠŸèƒ½æ¨¡å—ï¼š
>1. ç”¨æˆ·ç™»å½•ï¼ˆéªŒè¯ç ç™»å½•ã€çŸ­ä¿¡ç™»å½•ï¼‰
>2. å•†æˆ·æŸ¥è¯¢ï¼ˆåœ°ç†ä½ç½®ã€æ¨èï¼‰
>3. ç‚¹è¯„åŠŸèƒ½ï¼ˆç‚¹èµã€åˆ†é¡µï¼‰
>4. åº—é“ºç­¾åˆ°ã€ç”¨æˆ·ç­¾åˆ°è®°å½•
>5. å•†æˆ·ç¼“å­˜ï¼ˆ[[../ğŸŒ†åç«¯/Redis|Redis]]è§£å†³ç¼“å­˜å‡»ç©¿ã€é›ªå´©ã€ç©¿é€ï¼‰
>6. çƒ­ç‚¹è¯„ä»·ã€æ’è¡Œæ¦œï¼ˆåŸºäºç‚¹èµæ•°ï¼‰
>7. ç¼“å­˜é¢„çƒ­ã€é€»è¾‘è¿‡æœŸã€äº’æ–¥é”ç­‰ä¼˜åŒ–æ–¹æ¡ˆ
>8. åå°ç®¡ç†ï¼ˆæ•°æ®ç»Ÿè®¡ã€ç”¨æˆ·ç®¡ç†ï¼‰

| æŠ€æœ¯                           | è¯´æ˜                                  |
| ---------------------------- | ----------------------------------- |
| **Spring Boot**              | æ ¸å¿ƒæ¡†æ¶ï¼Œæ„å»º REST API                    |
| **Spring MVC**               | æ§åˆ¶å±‚å®ç°                               |
| **Spring Data Redis**        | ç¼“å­˜ã€åˆ†å¸ƒå¼é”ã€ç­¾åˆ°åŠŸèƒ½ç­‰                       |
| **MyBatis-Plus**             | æŒä¹…å±‚ ORM æ¡†æ¶ï¼Œç®€åŒ– MyBatis               |
| **MySQL**                    | ä¸»æ•°æ®åº“ï¼ˆä¸šåŠ¡æ•°æ®ï¼‰                          |
| **[[../ğŸŒ†åç«¯/Redis\|Redis]]** | ç¼“å­˜ï¼ˆå•†æˆ·ç¼“å­˜ã€éªŒè¯ç ã€ç­¾åˆ°ç­‰ï¼‰ã€åˆ†å¸ƒå¼è®¡æ•°ã€HyperLogLogç­‰ |

## æŠ€æœ¯æŒ‡å—

### Session å’Œ Cookie çš„åŒºåˆ«ï¼Ÿ

| ç‰¹æ€§       | Cookie                                         | Session                                        |
| -------- | ---------------------------------------------- | ---------------------------------------------- |
| **å­˜å‚¨ä½ç½®** | å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰                                       | æœåŠ¡ç«¯ï¼ˆå†…å­˜ã€æ–‡ä»¶ã€æ•°æ®åº“æˆ–åˆ†å¸ƒå¼ç¼“å­˜å¦‚ Redisï¼‰                    |
| **å­˜å‚¨å†…å®¹** | é€šå¸¸åªå­˜å‚¨å°‘é‡ä¿¡æ¯ï¼Œæœ€å¸¸è§çš„æ˜¯ **Session ID**                 | å­˜å‚¨**ç”¨æˆ·çš„å¤§é‡æ•æ„Ÿæˆ–éæ•æ„Ÿæ•°æ®**ï¼Œå¦‚ç”¨æˆ·IDã€ç”¨æˆ·åã€ç™»å½•çŠ¶æ€ã€æƒé™ä¿¡æ¯ç­‰       |
| **å®‰å…¨æ€§**  | ç›¸å¯¹è¾ƒä½ã€‚æ•°æ®ç›´æ¥æš´éœ²åœ¨å®¢æˆ·ç«¯ï¼Œæ˜“è¢«ç¯¡æ”¹æˆ–çªƒå–                        | è¾ƒé«˜ã€‚æ•æ„Ÿæ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯åªæŒæœ‰ Session ID               |
| **å®¹é‡é™åˆ¶** | æ¯ä¸ª Cookie å¤§å°é™åˆ¶åœ¨ 4KB å·¦å³ï¼Œä¸”æ¯ä¸ªåŸŸåä¸‹çš„ Cookie æ•°é‡ä¹Ÿæœ‰é™åˆ¶   | ç†è®ºä¸Šåªå—æœåŠ¡å™¨å­˜å‚¨èƒ½åŠ›çš„é™åˆ¶ï¼Œå®¹é‡æ›´å¤§                           |
| **ç”Ÿå‘½å‘¨æœŸ** | å¯ä»¥æ˜¯ä¼šè¯çº§åˆ« (æµè§ˆå™¨å…³é—­å³å¤±æ•ˆ)ï¼Œä¹Ÿå¯ä»¥æ˜¯æŒä¹…åŒ– (è®¾ç½®è¿‡æœŸæ—¶é—´)            | ä¾èµ–äº Session ID çš„æœ‰æ•ˆæ€§ï¼Œé€šå¸¸æœåŠ¡å™¨ä¼šè®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ã€‚é•¿æ—¶é—´ä¸æ´»åŠ¨ä¼šè‡ªåŠ¨å¤±æ•ˆ |
| **ä½œç”¨**   | ä¸»è¦ç”¨äº**å®¢æˆ·ç«¯çš„çŠ¶æ€ç»´æŠ¤**ï¼Œè®©æµè§ˆå™¨è®°ä½ä¸€äº›ä¿¡æ¯ï¼Œæœ€æ ¸å¿ƒçš„æ˜¯ä¼ é€’ Session ID | ä¸»è¦ç”¨äº**æœåŠ¡å™¨ç«¯çš„çŠ¶æ€ç»´æŠ¤**ï¼Œè®©æœåŠ¡å™¨è®°ä½ç”¨æˆ·æ˜¯è°ä»¥åŠå…¶ç›¸å…³ä¿¡æ¯            |
### ç™»å½•æ—¶ï¼šSession å’Œ Cookie æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ

- **ç”¨æˆ·æäº¤ç™»å½•ä¿¡æ¯ (å¦‚ç”¨æˆ·åã€å¯†ç )ï¼š**
    
    - ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¿¡æ¯å¹¶ç‚¹å‡»ç™»å½•ã€‚
        
- **æµè§ˆå™¨å°†ç™»å½•ä¿¡æ¯å‘é€ç»™æœåŠ¡å™¨ï¼š**
    
    - è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„ HTTP POST è¯·æ±‚ã€‚
        
- **æœåŠ¡å™¨éªŒè¯èº«ä»½ï¼š**
    
    - æœåŠ¡å™¨æ¥æ”¶åˆ°ç”¨æˆ·åå’Œå¯†ç ã€‚
        
    - æœåŠ¡å™¨æŸ¥è¯¢æ•°æ®åº“ï¼ˆæˆ–å…¶ä»–ç”¨æˆ·å­˜å‚¨ï¼‰ï¼ŒéªŒè¯ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦åŒ¹é…ã€‚
        
- **ã€Session çš„ä½œç”¨ã€‘éªŒè¯æˆåŠŸåï¼ŒæœåŠ¡å™¨åˆ›å»º Sessionï¼š**
    
    - å¦‚æœéªŒè¯é€šè¿‡ï¼ŒæœåŠ¡å™¨çŸ¥é“è¿™æ˜¯ä¸€ä¸ªåˆæ³•ç”¨æˆ·ã€‚
        
    - æœåŠ¡å™¨ä¼šä¸ºè¿™ä¸ªå·²ç™»å½•çš„ç”¨æˆ·åœ¨**æœåŠ¡å™¨ç«¯**åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„â€œä¼šè¯â€è®°å½•ã€‚
        
    - è¿™ä¸ªè®°å½•åŒ…å«ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œ`userId=123`ï¼Œ`username=zhangsan`ï¼Œä»¥åŠç™»å½•æ—¶é—´ã€æƒé™ç­‰ï¼‰ã€‚
        
    - æœåŠ¡å™¨ä¼šç»™è¿™ä¸ª Session è®°å½•åˆ†é…ä¸€ä¸ª**å”¯ä¸€çš„ Session ID**ï¼ˆä¾‹å¦‚ `ABCXYZ123`ï¼‰ã€‚
        
    - è¿™ä¸ª Session ID å’Œå¯¹åº”çš„ç”¨æˆ·æ•°æ®ï¼ˆKey-Value å¯¹ï¼‰ä¼šè¢«å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„æŸä¸ªåœ°æ–¹ï¼Œæ¯”å¦‚ï¼š
        
        - **åœ¨æ‚¨çš„ç‚¹è¯„é¡¹ç›®ä¸­ï¼Œè¿™ä¸ªåœ°æ–¹å°±æ˜¯ Redisã€‚** æœåŠ¡å™¨ä¼šå°† `ABCXYZ123` ä½œä¸º Keyï¼Œ`{userId: 123, username: "zhangsan", ...}` ä½œä¸º Value å­˜å‚¨åˆ° Redis ä¸­ï¼Œå¹¶é€šå¸¸ä¼šè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼ˆæ¯”å¦‚ 30 åˆ†é’Ÿä¸æ´»åŠ¨å°±å¤±æ•ˆï¼‰ã€‚
            
    - **ä½œç”¨æ€»ç»“ï¼š** Session ç¡®ä¿äº†æœåŠ¡å™¨èƒ½å¤Ÿâ€œè®°ä½â€è¿™ä½ç”¨æˆ·ï¼Œä»¥åŠè¯¥ç”¨æˆ·åœ¨ç™»å½•åçš„å„ç§çŠ¶æ€ä¿¡æ¯ã€‚
        
- **ã€Cookie çš„ä½œç”¨ã€‘æœåŠ¡å™¨å°† Session ID å‘é€ç»™æµè§ˆå™¨ï¼š**
    
    - æœåŠ¡å™¨å°†åˆšåˆšç”Ÿæˆçš„ **Session ID** (`ABCXYZ123`) æ”¾ç½®åœ¨ä¸€ä¸ª HTTP å“åº”å¤´ä¸­çš„ `Set-Cookie` å­—æ®µé‡Œã€‚
        
    - è¿™ä¸ª `Set-Cookie` æŒ‡ä»¤å‘Šè¯‰æµè§ˆå™¨ï¼šâ€œå˜¿ï¼ŒæŠŠè¿™ä¸ª `Session ID` (é€šå¸¸å‘½åä¸º `JSESSIONID` æˆ– `sid` ç­‰) å­˜èµ·æ¥ï¼â€
        
    - æœåŠ¡å™¨è¿˜ä¼šè®¾ç½® Cookie çš„ä¸€äº›å±æ€§ï¼Œæ¯”å¦‚è¿‡æœŸæ—¶é—´ã€ä½œç”¨åŸŸç­‰ã€‚
        
    - **ä½œç”¨æ€»ç»“ï¼š** Cookie çš„ä¸»è¦ä½œç”¨æ˜¯ä½œä¸º**Session ID çš„è½½ä½“**ã€‚å®ƒå°†æœåŠ¡å™¨ä¸ºç”¨æˆ·åˆ›å»ºçš„ Session ID ä¼ é€’å›å®¢æˆ·ç«¯æµè§ˆå™¨ï¼Œå¹¶åœ¨ç”¨æˆ·åç»­çš„è¯·æ±‚ä¸­ï¼Œç”±æµè§ˆå™¨è‡ªåŠ¨å¸¦å›ç»™æœåŠ¡å™¨ã€‚
        
- **æµè§ˆå™¨å­˜å‚¨ Cookieï¼š**
    
    - æµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡å™¨çš„å“åº”åï¼Œå°†è¿™ä¸ªåŒ…å« `Session ID` çš„ Cookie (ä¾‹å¦‚ `JSESSIONID=ABCXYZ123`) å­˜å‚¨åœ¨æœ¬åœ°ã€‚
        
- **ç”¨æˆ·åç»­è®¿é—®ï¼ˆä¿æŒç™»å½•çŠ¶æ€ï¼‰ï¼š**
    
    - å½“ç”¨æˆ·ç‚¹å‡»ç½‘ç«™ä¸Šçš„å…¶ä»–é“¾æ¥ï¼ˆä¾‹å¦‚â€œæˆ‘çš„è®¢å•â€ã€â€œå‘å¸ƒè¯„è®ºâ€ï¼‰æ—¶ï¼Œ**æµè§ˆå™¨ä¼šè‡ªåŠ¨å°†å­˜å‚¨çš„ `JSESSIONID=ABCXYZ123` è¿™ä¸ª Cookie é™„åŠ åˆ°æ¯ä¸ª HTTP è¯·æ±‚å¤´ä¸­**ï¼Œå‘é€ç»™æœåŠ¡å™¨ã€‚
        
    - **ä½œç”¨æ€»ç»“ï¼š** Cookie è´Ÿè´£åœ¨æ¯æ¬¡è¯·æ±‚æ—¶ï¼Œå°†æœåŠ¡å™¨ä¹‹å‰åˆ†å‘ç»™å®ƒçš„â€œèº«ä»½å‡­è¯â€ï¼ˆSession IDï¼‰ä¼ å›ç»™æœåŠ¡å™¨ã€‚
        
- **ã€Session çš„ä½œç”¨ã€‘æœåŠ¡å™¨æ ¹æ® Cookie ä¸­çš„ Session ID è¯†åˆ«ç”¨æˆ·ï¼š**
    
    - æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šä»è¯·æ±‚å¤´ä¸­è§£æå‡º `Session ID` (`ABCXYZ123`)ã€‚
        
    - æœåŠ¡å™¨ä½¿ç”¨è¿™ä¸ª `Session ID` åˆ°å…¶**æœåŠ¡å™¨ç«¯å­˜å‚¨**ï¼ˆä¾‹å¦‚ Redisï¼‰ä¸­å»æŸ¥æ‰¾å¯¹åº”çš„ Session æ•°æ®ã€‚
        
    - å¦‚æœæ‰¾åˆ°äº†ï¼Œå¹¶ä¸” Session æœªè¿‡æœŸï¼ŒæœåŠ¡å™¨å°±çŸ¥é“è¿™ä¸ªè¯·æ±‚æ˜¯æ¥è‡ª `userId=123` çš„ `zhangsan` ç”¨æˆ·ï¼Œä»è€Œå…è®¸ä»–æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚
        
    - **ä½œç”¨æ€»ç»“ï¼š** Session å…è®¸æœåŠ¡å™¨æ ¹æ®å®¢æˆ·ç«¯ä¼ æ¥çš„ Session IDï¼ŒæŸ¥æ‰¾åˆ°å¹¶æ¢å¤ç”¨æˆ·çš„èº«ä»½å’ŒçŠ¶æ€ï¼Œä»è€Œç»´æŒç”¨æˆ·çš„ç™»å½•çŠ¶æ€å’Œä¸ªæ€§åŒ–ä½“éªŒã€‚

**æ ¸å¿ƒåŒºåˆ«å’Œåä½œæ–¹å¼ï¼š**

- **Cookie å°±åƒä¸€å¼ â€œé—¨ç¥¨â€**ï¼Œè¿™å¼ é—¨ç¥¨ä¸Šå†™ç€ä¸€ä¸ª**åº§ä½å·**ï¼ˆSession IDï¼‰ï¼Œå®ƒå­˜åœ¨ä½ ï¼ˆæµè§ˆå™¨ï¼‰çš„å£è¢‹é‡Œã€‚
    
- **Session å°±åƒç”µå½±é™¢é‡Œçš„â€œåº§ä½å’Œä½ çš„é¢„ç•™ä¿¡æ¯â€**ï¼Œç”µå½±é™¢ï¼ˆæœåŠ¡å™¨ï¼‰æ ¹æ®ä½ é—¨ç¥¨ä¸Šçš„åº§ä½å·ï¼ˆSession IDï¼‰ï¼Œæ‰èƒ½æ‰¾åˆ°ä½ çš„é¢„ç•™ä¿¡æ¯ï¼Œå¹¶ç¡®è®¤ä½ æ˜¯è°ã€‚
    

æ²¡æœ‰ Cookieï¼ˆé—¨ç¥¨ï¼‰ï¼ŒæœåŠ¡å™¨å°±æ— æ³•ä»ä½ é‚£é‡Œè·å–åˆ° Session IDï¼Œä¹Ÿå°±æ— æ³•æ‰¾åˆ°ä½ çš„ Sessionã€‚ æ²¡æœ‰ Sessionï¼ˆæœåŠ¡å™¨ç«¯çš„è®°å½•ï¼‰ï¼Œå³ä½¿æœ‰äº† Cookie ä¸­çš„ Session IDï¼ŒæœåŠ¡å™¨ä¹Ÿæ— æ³•çŸ¥é“ä½ æ˜¯è°ã€‚

æ‰€ä»¥ï¼Œå®ƒä»¬æ˜¯ç›¸äº’ä¾èµ–ï¼Œå…±åŒå®ç° Web åº”ç”¨ä¸­ç”¨æˆ·çŠ¶æ€ç®¡ç†çš„åŸºçŸ³ã€‚

### æ‹¦æˆªå™¨å’Œ ThreadLocal

### æ‹¦æˆªå™¨ï¼ˆæœåŠ¡ç«¯ï¼‰

```java
public class LoginInterceptor implements HandlerInterceptor {  
    @Override  
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {  
        HttpSession session = request.getSession();  
        Object user = session.getAttribute("user");  
        if (user == null) {  
            response.setStatus(401);  
            return false;  
        }  
        UserHolder.saveUser( (UserDTO) user);  
        return true;  
    }  
  
    @Override  
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {  
        UserHolder.removeUser();  
    }  
}
```

### HttpServletRequest å·¥ä½œåŸç†

è°ƒç”¨ `HttpServeletRequest.getSession()` æ—¶ï¼ŒSpringMVCï¼ˆåº•å±‚æ˜¯ Servlet å®¹å™¨ï¼Œå¦‚ Tomcatï¼‰ä¼šåšï¼š
1. **æ£€æŸ¥è¯·æ±‚ä¸­æ˜¯å¦åŒ…å« Session IDï¼š**
	- å®ƒä¼šæ£€æŸ¥å½“å‰ HTTP è¯·æ±‚çš„ `Cookie` å¤´ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªåä¸º `JSESSIONID`ï¼ˆæˆ–ä½ é…ç½®çš„å…¶ä»– Session Cookie åç§°ï¼‰çš„ Cookie
	- å¦‚æœå­˜åœ¨ï¼Œå®ƒä¼šè·å–è¿™ä¸ª `Session ID`
2. **æ ¹æ® Session ID æŸ¥æ‰¾ Session å¯¹è±¡ï¼š**
	- **å…³é”®!** Servlet å®¹å™¨ä¼šä½¿ç”¨è¿™ä¸ª `Session ID` åˆ°**æœåŠ¡å™¨ç«¯**çš„ Session å­˜å‚¨ä¸­å»æŸ¥æ‰¾å¯¹åº”çš„ `HttpSession` å¯¹è±¡
	- åœ¨ä½ çš„ Redis ç‚¹è¯„é¡¹ç›®ä¸­ï¼Œè¿™ä¸ª Session å­˜å‚¨å°±æ˜¯ **Redis**ã€‚è¿™æ„å‘³ç€ï¼Œå½“ç”¨æˆ·ç™»å½•æˆåŠŸæ—¶ï¼Œä½ çš„ä»£ç ï¼ˆæˆ–è€… Spring Session ç­‰æ¡†æ¶ï¼‰å·²ç»å°† `UserDTO` å¯¹è±¡ï¼ˆæˆ–å…¶åºåˆ—åŒ–åçš„æ•°æ®ï¼‰ä»¥ `user` ä¸ºé”®ï¼Œå­˜å‚¨åˆ°äº†ä¸è¯¥ `Session ID` å…³è”çš„ Redis è®°å½•ä¸­
3. **è¿”å› `HttpSession` å¯¹è±¡ï¼š**
	- å¦‚æœæ‰¾åˆ°äº†å¯¹åº”çš„ `HttpSession` å¯¹è±¡ï¼Œå®¹å™¨å°±å°†å®ƒè¿”å›ç»™ä½ 
	- å¦‚æœæ²¡æœ‰æ‰¾åˆ° `Session ID`ï¼ˆæ¯”å¦‚é¦–æ¬¡è®¿é—®ï¼‰ï¼Œæˆ–è€…æ‰¾åˆ°çš„ `Session ID` æ— æ•ˆ/è¿‡æœŸï¼Œé‚£ä¹ˆ `request.getSession()` ä¼š**åˆ›å»ºä¸€ä¸ªæ–°çš„ `HttpSession` å¯¹è±¡**ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„ `Session ID`ï¼Œç„¶åå°†è¿™ä¸ªæ–°çš„ `Session ID` é€šè¿‡ `Set-Cookie` å¤´å‘é€å›æµè§ˆå™¨

### ThreadLocal

`ThreadLocal` æ˜¯ Java æä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºä¸€ä¸ª**çº¿ç¨‹å±€éƒ¨å˜é‡**

>æ ¸å¿ƒæ€æƒ³

`ThreadLocal` ä¸ºæ¯ä¸ªä½¿ç”¨å®ƒçš„çº¿ç¨‹éƒ½åˆ›å»ºäº†ä¸€ä¸ªå˜é‡å‰¯æœ¬ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æ“ä½œè‡ªå·±çš„å‰¯æœ¬ï¼Œäº’ä¸å¹²æ‰°ã€‚

>ç™»å½•è®¤è¯ä¸­çš„ä½œç”¨

åœ¨ Web åº”ç”¨ä¸­ï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨ Spring MVC è¿™æ ·çš„æ¡†æ¶æ—¶ï¼Œæ¯ä¸ª HTTP è¯·æ±‚é€šå¸¸ä¼šç”±æœåŠ¡å™¨ï¼ˆå¦‚ Tomcatï¼‰åˆ†é…ç»™ä¸€ä¸ª**ç‹¬ç«‹çš„çº¿ç¨‹**æ¥å¤„ç†ã€‚ä»è¯·æ±‚è¿›å…¥æ‹¦æˆªå™¨ã€åˆ°è¾¾ Controllerã€å†åˆ° Service å±‚ï¼Œç›´åˆ°å“åº”è¿”å›ï¼Œæ•´ä¸ªæµç¨‹éƒ½åœ¨è¿™ä¸ªåŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚

å½“ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œæˆ‘ä»¬è·å–åˆ°äº†ç”¨æˆ·çš„ `UserDTO` ä¿¡æ¯ã€‚åœ¨ä¸ä½¿ç”¨ `ThreadLocal` çš„æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦ä¸€å±‚ä¸€å±‚åœ°å°† `UserDTO` ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä½ çš„ Controllerã€Serviceã€ç”šè‡³ Dao å±‚æ–¹æ³•

è¿™æ ·ä¼šå¯¼è‡´ä»£ç å†—ä½™ï¼Œå¹¶ä¸”å¾ˆå¤šä¸šåŠ¡æ–¹æ³•æœ¬èº«å¹¶ä¸éœ€è¦ç›´æ¥æ“ä½œ `UserDTO`ï¼Œåªæ˜¯ä¸ºäº†ä¼ é€’ç»™ä¸‹å±‚æ–¹æ³•

>`ThreadLocal` çš„ä¼˜ç‚¹

- **ç®€åŒ–ä»£ç ï¼š** é¿å…äº†åœ¨æ–¹æ³•é—´å±‚å±‚ä¼ é€’ç”¨æˆ·ä¿¡æ¯çš„å‚æ•°ï¼Œä½¿ä»£ç æ›´ç®€æ´ã€å¯è¯»æ€§æ›´å¥½ã€‚
- **çº¿ç¨‹éš”ç¦»ï¼š** ç¡®ä¿æ¯ä¸ªçº¿ç¨‹çš„æ•°æ®ç‹¬ç«‹ï¼Œä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

>`ThreadLocal` çš„ç¼ºç‚¹

- å†…å­˜æ³„æ¼
- æ»¥ç”¨é—®é¢˜
- è°ƒè¯•éš¾åº¦
### Session å…±äº«é—®é¢˜

è§£å†³æ–¹æ¡ˆï¼šç”¨ Redis æ›¿ä»£ Session

![](assets/1653319474181.png)

